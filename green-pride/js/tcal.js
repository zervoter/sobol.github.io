function f_tcalGetHTML(t){var e=f_tcalGetInputs(!0);if(e){var n=A_TCALCONF.cssprefix,a=A_TCALCONF.format,r=f_tcalParseDate(A_TCALCONF.today,A_TCALCONF.format);r||(r=f_tcalResetTime(new Date));var l=f_tcalParseDate(e.value,a);l||(l=f_tcalParseDate(A_TCALCONF.selected,A_TCALCONF.format)),l||(l=new Date(r)),t=t?f_tcalResetTime(t):new Date(l);var o=new Date(t);o.setDate(1),o.setDate(1-(7+o.getDay()-A_TCALCONF.weekstart)%7);for(var s,f='<table id="'+n+'Controls"><tbody><tr>'+(A_TCALCONF.yearscroll?'<td id="'+n+'PrevYear" '+f_tcalRelDate(t,-1,"y")+' title="'+A_TCALCONF.prevyear+'"></td>':"")+'<td id="'+n+'PrevMonth"'+f_tcalRelDate(t,-1)+' title="'+A_TCALCONF.prevmonth+'"></td><th>'+A_TCALCONF.months[t.getMonth()]+" "+t.getFullYear()+'</th><td id="'+n+'NextMonth"'+f_tcalRelDate(t,1)+' title="'+A_TCALCONF.nextmonth+'"></td>'+(A_TCALCONF.yearscroll?'<td id="'+n+'NextYear"'+f_tcalRelDate(t,1,"y")+' title="'+A_TCALCONF.nextyear+'"></td>':"")+'</tr></tbody></table><table id="'+n+'Grid"><tbody><tr>',i=0;i<7;i++)f+="<th>"+A_TCALCONF.weekdays[(A_TCALCONF.weekstart+i)%7]+"</th>";f+="</tr>";for(var c,d=new Date(o);d.getMonth()==t.getMonth()||d.getMonth()==o.getMonth();){f+="<tr>";for(var _=0;_<7;_++)s=[],c=d.getDate(),d.getMonth(),d.getMonth()!=t.getMonth()&&(s[s.length]=n+"OtherMonth"),0!=d.getDay()&&6!=d.getDay()||(s[s.length]=n+"Weekend"),d.valueOf()==r.valueOf()&&(s[s.length]=n+"Today"),d.valueOf()==l.valueOf()&&(s[s.length]=n+"Selected"),f+="<td"+f_tcalRelDate(d)+(s.length?' class="'+s.join(" ")+'">':">")+c+"</td>",d.setDate(++c);f+="</tr>"}return f+="</tbody></table>"}}function f_tcalRelDate(t,e,n){var n="y"==n?"FullYear":"Month",a=new Date(t);return e&&(a["set"+n](t["get"+n]()+e),a.getDate()!=t.getDate()&&a.setDate(0)),' onclick="f_tcalUpdate('+a.valueOf()+(e?",1":"")+')"'}function f_tcalResetTime(t){return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(12),t}function f_tcalCancel(){var t=A_TCALCONF.cssprefix,e=document.getElementById(t);e&&(e.style.visibility="");for(var n=f_tcalGetInputs(),a=0;a<n.length;a++)f_tcalRemoveClass(n[a],t+"Active")}function f_tcalUpdate(t,e){var n=f_tcalGetInputs(!0);if(n){d_date=new Date(t);var a=A_TCALCONF.cssprefix;if(e){var r=document.getElementById(a);if(!r||"visible"!=r.style.visibility)return;r.innerHTML=f_tcalGetHTML(d_date,n)}else n.value=f_tcalGenerateDate(d_date,A_TCALCONF.format),f_tcalCancel()}}function f_tcalOnClick(){var t=A_TCALCONF.cssprefix,e=t+"Active",n=f_tcalHasClass(this,e);if(f_tcalCancel(),!n){f_tcalAddClass(this,e);var a=f_getPosition(this,"Left"),r=f_getPosition(this,"Top")+this.offsetHeight,l=document.getElementById(t);l||(l=document.createElement("div"),l.onselectstart=function(){return!1},l.id=t,document.getElementsByTagName("body").item(0).appendChild(l)),l.innerHTML=f_tcalGetHTML(null),l.style.top=r+"px",l.style.left=a+this.offsetWidth-l.offsetWidth+"px",l.style.visibility="visible"}}function f_tcalParseDate(t,e){if(t){for(var n,a="^",r={},l=0,o=0;o<e.length;o++)n=e.charAt(o),A_TCALTOKENS_IDX[n]?(r[n]=++l,a+="("+A_TCALTOKENS_IDX[n].r+")"):a+=" "==n?"\\s":(n.match(/[\w\d]/)?"":"\\")+n;var s=new RegExp(a+"$");if(t.match(s)){var f,i=f_tcalResetTime(new Date);for(i.setDate(1),o=0;o<A_TCALTOKENS.length;o++)n=A_TCALTOKENS[o].t,r[n]&&(f=RegExp["$"+r[n]],i=A_TCALTOKENS[o].p(i,f));return i}}}function f_tcalGenerateDate(t,e){for(var n,a="",r=0;r<e.length;r++)n=e.charAt(r),a+=A_TCALTOKENS_IDX[n]?A_TCALTOKENS_IDX[n].g(t):n;return a}function f_tcalGetInputs(t){var e,a=document.getElementsByTagName("input"),r=[];for(n=0;n<a.length;n++)if(e=a[n],e.type&&"text"==e.type&&f_tcalHasClass(e,"tcal")){if(t&&f_tcalHasClass(e,A_TCALCONF.cssprefix+"Active"))return e;r[r.length]=e}return t?null:r}function f_tcalHasClass(t,e){var n=t.className;if(!n)return!1;for(var a=n.split(" "),r=0;r<a.length;r++)if(a[r]==e)return!0;return!1}function f_tcalAddClass(t,e){if(!f_tcalHasClass(t,e)){var n=t.className;t.className=(n?n+" ":"")+e}}function f_tcalRemoveClass(t,e){var n=t.className;if(!n||n.indexOf(e)==-1)return!1;for(var a=n.split(" "),r=[],l=0;l<a.length;l++)a[l]!=e&&(r[r.length]=a[l]);return t.className=r.join(" "),!0}function f_getPosition(t,e){for(var n,a=0,r=t;r;)n=r["offset"+e],a+=n,r=r.offsetParent;for(r=t;r!=document.body;)n=r["scroll"+e],n&&"scroll"==r.style.overflow&&(a-=n),r=r.parentNode;return a}function f_tcalInit(){if(document.getElementsByTagName){for(var t,e=f_tcalGetInputs(),n=0;n<e.length;n++)t=e[n],t.onclick=f_tcalOnClick,f_tcalAddClass(t,A_TCALCONF.cssprefix+"Input");for(window.A_TCALTOKENS_IDX={},n=0;n<A_TCALTOKENS.length;n++)A_TCALTOKENS_IDX[A_TCALTOKENS[n].t]=A_TCALTOKENS[n]}}function f_tcalAddOnload(t){if(document.addEventListener)window.addEventListener("load",t,!1);else if(window.attachEvent)window.attachEvent("onload",t);else{var e=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){e(),t()}}}var A_TCALCONF={cssprefix:"tcal",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],longwdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],yearscroll:!0,weekstart:0,prevyear:"Предыдущий год",nextyear:"Следующий год",prevmonth:"Предыдущий месяц",nextmonth:"Следующий месяц",format:"d-m-Y"},A_TCALTOKENS=[{t:"Y",r:"19\\d{2}|20\\d{2}",p:function(t,e){return t.setFullYear(Number(e)),t},g:function(t){return t.getFullYear()}},{t:"m",r:"0?[1-9]|1[0-2]",p:function(t,e){return t.setMonth(Number(e)-1),t},g:function(t){var e=t.getMonth()+1;return(e<10?"0":"")+e}},{t:"F",r:A_TCALCONF.months.join("|"),p:function(t,e){for(var n=0;n<12;n++)if(A_TCALCONF.months[n]==e)return t.setMonth(n),t},g:function(t){return A_TCALCONF.months[t.getMonth()]}},{t:"d",r:"0?[1-9]|[12][0-9]|3[01]",p:function(t,e){return t.setDate(Number(e)),t.getDate()!=e&&t.setDate(0),t},g:function(t){var e=t.getDate();return(e<10?"0":"")+e}},{t:"j",r:"0?[1-9]|[12][0-9]|3[01]",p:function(t,e){return t.setDate(Number(e)),t.getDate()!=e&&t.setDate(0),t},g:function(t){return t.getDate()}},{t:"l",r:A_TCALCONF.longwdays.join("|"),p:function(t,e){return t},g:function(t){return A_TCALCONF.longwdays[t.getDay()]}},{t:"S",r:"st|nd|rd|th",p:function(t,e){return t},g:function(t){return n_date=t.getDate(),n_date%10==1&&11!=n_date?"st":n_date%10==2&&12!=n_date?"nd":n_date%10==3&&13!=n_date?"rd":"th"}}];f_tcalAddOnload(f_tcalInit);